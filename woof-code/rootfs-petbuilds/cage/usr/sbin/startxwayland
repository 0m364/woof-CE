#!/bin/sh

# heavily inspired by https://source.mnt.re/reform/reform-system-image/-/blob/d9ed139c4fb7e4443c0fc1d226021a2671e28da8/reform2-imx8mq/template-skel/bin/reform-windowmaker

cage -ds -- Xwayland :0 &

export DISPLAY=:0

MAX=20
CT=0
while ! xdpyinfo >/dev/null 2>&1; do
    sleep 0.50s
    CT=$(( CT + 1 ))
    if [ "$CT" -ge "$MAX" ]; then
        LOG "FATAL: $0: Gave up waiting for X server $DISPLAY"
        exit 11
    fi
done

GDK_BACKEND=x11 exec ~/.xinitrc